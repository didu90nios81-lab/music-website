<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FOR THE PRETIIEST PURBA GIRL</title>
<link rel="icon" type="image/png" href="download.png">

<style>
/* ===========================
   RESET & BASE
   =========================== */
* { box-sizing: border-box; margin: 0; padding: 0; }
html,body { height: 100%; }
body {
  font-family: "Arial", Helvetica, sans-serif;
  background: linear-gradient(135deg,#ff9a9e 0%,#ff758c 100%);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

/* ===========================
   CONTAINER & LAYOUT
   =========================== */
.container {
  width: 100%;
  max-width: 980px;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(8px);
  border-radius: 18px;
  padding: 26px;
  box-shadow: 0 14px 40px rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.12);
}

.header {
  display:flex;
  gap:16px;
  align-items:center;
  justify-content:space-between;
  margin-bottom: 18px;
}

.brand {
  display:flex;
  gap:12px;
  align-items:center;
}
.brand img { width:56px; height:56px; border-radius:10px; object-fit:cover; }
.brand h1 {
  font-size:18px;
  letter-spacing:0.6px;
  text-transform:uppercase;
  margin-bottom:2px;
}
.brand p { font-size:12px; opacity:0.9; }

/* ===========================
   STAGES
   =========================== */
.stage { transition: all 260ms ease; }
.hidden { display:none !important; }

/* main question */
.question {
  font-size: 24px;
  font-weight:700;
  margin: 14px 0 18px 0;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.25);
  text-align:center;
}

/* buttons */
.buttons { display:flex; gap:14px; justify-content:center; flex-wrap:wrap; margin-bottom:14px; }
button {
  cursor:pointer;
  border: none;
  border-radius: 999px;
  padding: 12px 26px;
  font-weight:700;
  letter-spacing:0.6px;
  text-transform:uppercase;
  box-shadow: 0 6px 18px rgba(0,0,0,0.22);
}
.btn-yes { background: linear-gradient(45deg,#4CAF50,#45a049); color:#fff; }
.btn-no  { background: linear-gradient(45deg,#f44336,#da190b); color:#fff; }
.btn-back { background: linear-gradient(45deg,#667eea,#764ba2); color:#fff; padding:8px 18px; }

/* error message */
.error-message {
  color: #ff6b6b;
  font-weight:700;
  text-align:center;
  margin-top:10px;
  display:none;
}

/* ===========================
   FOLDER GRID (cards)
   =========================== */
.folder-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap:14px;
  margin-top:18px;
}

.folder-card {
  background: rgba(255,255,255,0.06);
  padding:18px;
  border-radius:12px;
  cursor:pointer;
  transition: transform 220ms ease, box-shadow 220ms ease, background 220ms;
  border:1px solid rgba(255,255,255,0.06);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
}
.folder-card:focus { outline:3px solid rgba(255,255,255,0.06); }
.folder-card:hover { transform: translateY(-6px); background: rgba(255,255,255,0.10); box-shadow: 0 18px 30px rgba(0,0,0,0.28); }
.folder-icon { font-size:44px; }
.folder-name { font-weight:800; }
.folder-desc { font-size:13px; opacity:0.9; text-align:center; }

/* ===========================
   GALLERY VIEW
   =========================== */
.gallery-header {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  margin-bottom:14px;
}
.gallery-title { font-weight:800; font-size:18px; }
.gallery-body { margin-top:8px; }

/* photo gallery kept for uniformity - video grid uses same styling */
.gallery-grid {
  display:grid;
  gap:12px;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
}

/* video card */
.video-card {
  background: rgba(255,255,255,0.04);
  border-radius:10px;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  border:1px solid rgba(255,255,255,0.04);
  position:relative;
  min-height: 160px;
}
.video-card:focus-within { outline: 3px solid rgba(255,255,255,0.06); }

.video-thumb {
  width:100%;
  border-radius:8px;
  overflow:hidden;
  background: linear-gradient(180deg, rgba(0,0,0,0.15), rgba(0,0,0,0.25));
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  height:0;
  padding-bottom:56%;
}

/* use native <video> as thumbnail for better preview if supported */
.video-thumb video, .video-thumb img {
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* overlay controls (play icon) */
.play-overlay {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}
.play-button {
  pointer-events:auto;
  width:56px;
  height:56px;
  border-radius:50%;
  background: rgba(0,0,0,0.45);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  color:#fff;
  border:2px solid rgba(255,255,255,0.08);
  transition: transform 160ms ease;
}
.play-button:active { transform: scale(0.96); }

/* meta */
.video-meta { display:flex; justify-content:space-between; align-items:center; gap:8px; font-size:13px; }
.video-title { font-weight:700; }
.video-actions { display:flex; gap:8px; align-items:center; }

/* loading indicator & error message per card */
.loading-dot {
  width:10px; height:10px; border-radius:50%;
  background: rgba(255,255,255,0.6);
  animation: pulse 900ms infinite ease-in-out;
}
@keyframes pulse { 0% { transform:scale(0.8); opacity:0.6 } 50% { transform:scale(1.2); opacity:1 } 100% { transform:scale(0.8); opacity:0.6 } }

.card-error { color:#ff6b6b; font-size:13px; font-weight:700; }

/* direct player (expanded when clicked) */
.player-expanded {
  margin-top:12px;
  background: rgba(0,0,0,0.25);
  padding:10px;
  border-radius:8px;
}

/* responsive */
@media (max-width:720px) {
  .brand h1 { font-size:16px; }
  .video-meta { font-size:12px; }
  .video-thumb { padding-bottom:56%; }
}
</style>
</head>
<body>
<div class="container" role="application" aria-label="Galeri Musik dan Video">
  <header class="header">
    <div class="brand">
      <img src="./menu/abc.jpg" alt="logo" onerror="this.style.display='none'">
      <div>
        <h1>For The Pretiiist Purba Girl</h1>
        <p>Galeri ‚Äî Foto, Musik, Video</p>
      </div>
    </div>
    <div>
      <button class="btn-back" id="btn-home" type="button">Beranda</button>
    </div>
  </header>

  <!-- STAGE 1: Prompt -->
  <main id="stage1" class="stage">
    <div class="question">Apakah Anda Mau?</div>
    <div class="buttons" role="group" aria-label="Pilihan awal">
      <button class="btn-yes" id="btn-yes-start">Boleh Deh</button>
      <button class="btn-no" id="btn-no-start">Gamau</button>
    </div>
    <div id="error1" class="error-message" role="status">ERROR: Ga Boleh Nolak!!!! wkwkwk.</div>
  </main>

  <!-- STAGE 2: Secondary -->
  <section id="stage2" class="stage hidden">
    <div class="question">Will You?</div>
    <div class="buttons">
      <button class="btn-yes" id="btn-go-folders">Ya</button>
      <button class="btn-no" id="btn-no-2">NOO!!!!!</button>
    </div>
    <div id="error2" class="error-message" role="status">Baiklah, Silahkan tinggalkan website. Saya akan berusaha lebih keras lagi</div>
  </section>

  <!-- FOLDER MENU -->
  <section id="folderMenu" class="stage hidden" aria-live="polite">
    <div class="question">Pilih Folder yang Ingin Dilihat</div>
    <div class="folder-grid" id="folderGrid" tabindex="0"></div>
    <div style="text-align:center; margin-top:12px;">
      <button class="btn-no" id="btn-reset">üîÑ Kembali ke Awal</button>
    </div>
  </section>

  <!-- GALLERY / VIEW -->
  <section id="galleryView" class="stage hidden" aria-live="polite">
    <div class="gallery-header">
      <div class="gallery-title" id="galleryTitle">Gallery</div>
      <div>
        <button class="btn-back" id="btn-back-to-folders">‚Üê Kembali</button>
      </div>
    </div>

    <!-- Music player area (hidden for video-only) -->
    <div id="musicPlayerContainer" class="hidden" style="margin-bottom:10px;">
      <div class="music-player">
        <div class="music-title" id="musicTitle">Now Playing...</div>
        <audio id="audioPlayer" controls preload="metadata" style="width:100%; max-width:560px;"></audio>
      </div>
    </div>

    <div id="galleryBody" class="gallery-body">
      <div id="photoGalleryContainer" class="gallery-grid" style="display:none;"></div>
      <div id="videoGalleryContainer" class="gallery-grid"></div>
    </div>

    <div id="galleryLoading" class="loading" style="display:none; text-align:center; margin-top:12px;">
      <div style="display:inline-flex; gap:8px; align-items:center;">
        <span class="loading-dot" aria-hidden="true"></span>
        <span>Memuat konten...</span>
      </div>
    </div>
  </section>

  <!-- global error / status area -->
  <div id="globalStatus" style="margin-top:14px; text-align:center; font-size:13px; display:none;"></div>
</div>

<script>
/* ===========================
   CONFIG
   =========================== */
/* Use relative base path (works on GitHub Pages) */
const GITHUB_BASE = './'; // jika pakai root repo / GitHub Pages, biarkan './'

/* Daftar file video (pastikan ada di folder /video/ dan berformat .webm) */
const VIDEO_FILES = [
  { id: '1', file: '1.webm', title: 'Video 1' },
  { id: '2', file: '2.webm', title: 'Video 2' },
  { id: 'jalandikapal', file: 'jalandikapal.webm', title: 'Jalan di Kapal' },
  { id: '4', file: '4.webm', title: 'Video 4' }
];

/* Konfigurasi folder lain (photo/music) ‚Äî tetap ada supaya menu lengkap */
const FOLDERS_CONFIG = {
  fotobersama: { name: 'Foto Bersama', icon:'üòä', desc:'Terima Kasih Ya Udah Mau Ngajak Aku Foto', type:'photo' },
  gambar: { name: 'Lain-Lain', icon:'üì∏', desc:'Koleksi foto', type:'photo' },
  gambarsendiri: { name:'Foto Sendiri', icon:'üßë', desc:'Foto manusia khusus', type:'photo' },
  masak: { name:'Masak', icon:'üç≥', desc:'Memberi makan mahasiswa tidak sehat', type:'photo' },
  video: { name:'Video', icon:'üé¨', desc:':) ', type:'video' }
};

/* ===========================
   UTILITIES
   =========================== */

/* safeLog - tampilkan ke console dan optionally ke UI */
function safeLog(...args) { console.log('[app]', ...args); }

function setGlobalStatus(msg, isError=false) {
  const el = document.getElementById('globalStatus');
  el.style.display = msg ? 'block' : 'none';
  el.textContent = msg || '';
  el.style.color = isError ? '#ff8b8b' : '#d8ffd8';
}

/* helper to create element with attributes quickly */
function el(tag, attrs={}, ...children) {
  const d = document.createElement(tag);
  for (const k in attrs) {
    if (k === 'class') d.className = attrs[k];
    else if (k === 'html') d.innerHTML = attrs[k];
    else d.setAttribute(k, attrs[k]);
  }
  for (const c of children) {
    if (typeof c === 'string') d.appendChild(document.createTextNode(c));
    else if (c instanceof Node) d.appendChild(c);
  }
  return d;
}

/* check if browser supports webm (simple) */
function supportsWebM() {
  try {
    const v = document.createElement('video');
    return v.canPlayType && (v.canPlayType('video/webm; codecs="vp8,vorbis"') ||
                              v.canPlayType('video/webm; codecs="vp9"') ||
                              v.canPlayType('video/webm'));
  } catch(e){ return false; }
}

/* generate data-URL SVG placeholder (used as fallback poster) */
function svgPlaceholder(text='No image') {
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1280' height='720' viewBox='0 0 1280 720'>
    <rect width='100%' height='100%' fill='#222'/>
    <text x='50%' y='50%' fill='#888' font-size='28' font-family='Arial' dominant-baseline='middle' text-anchor='middle'>${text}</text>
  </svg>`;
  return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
}

/* ===========================
   DOM REFERENCES
   =========================== */
const refs = {
  stage1: document.getElementById('stage1'),
  stage2: document.getElementById('stage2'),
  folderMenu: document.getElementById('folderMenu'),
  galleryView: document.getElementById('galleryView'),
  folderGrid: document.getElementById('folderGrid'),
  videoContainer: document.getElementById('videoGalleryContainer'),
  galleryLoading: document.getElementById('galleryLoading'),
  galleryTitle: document.getElementById('galleryTitle'),
  musicPlayerContainer: document.getElementById('musicPlayerContainer'),
  audioPlayer: document.getElementById('audioPlayer'),
  musicTitle: document.getElementById('musicTitle'),
  btnHome: document.getElementById('btn-home'),
  btnReset: document.getElementById('btn-reset'),
  btnBackToFolders: document.getElementById('btn-back-to-folders')
};

/* ===========================
   INITIALIZATION / EVENT BINDINGS
   =========================== */

function init() {
  // Basic interactions
  document.getElementById('btn-yes-start').addEventListener('click', () => {
    refs.stage1.classList.add('hidden');
    refs.stage2.classList.remove('hidden');
  });
  document.getElementById('btn-no-start').addEventListener('click', () => {
    const e = document.getElementById('error1'); e.style.display = 'block';
    setTimeout(()=> e.style.display='none', 2800);
  });
  document.getElementById('btn-go-folders').addEventListener('click', () => {
    refs.stage2.classList.add('hidden');
    showFolderMenu();
  });
  document.getElementById('btn-no-2').addEventListener('click', ()=> {
    const e = document.getElementById('error2'); e.style.display='block';
    setTimeout(()=> e.style.display='none', 3200);
  });

  refs.btnHome.addEventListener('click', ()=> {
    // always go to start
    refs.galleryView.classList.add('hidden');
    refs.folderMenu.classList.add('hidden');
    refs.stage2.classList.add('hidden');
    refs.stage1.classList.remove('hidden');
    setGlobalStatus('');
  });

  refs.btnReset.addEventListener('click', ()=> location.reload());
  refs.btnBackToFolders.addEventListener('click', ()=> {
    refs.galleryView.classList.add('hidden');
    refs.folderMenu.classList.remove('hidden');
    stopAllPlayers();
  });

  // populate folder menu
  createFolderMenu();

  // initial compatibility notice
  if (!supportsWebM()) {
    setGlobalStatus('Peringatan: Browser ini mungkin tidak mendukung format .webm ‚Äî beberapa video bisa tidak diputar.', true);
  } else {
    setGlobalStatus('');
  }
}

/* ===========================
   FOLDER MENU RENDERER
   =========================== */
function createFolderMenu() {
  const grid = refs.folderGrid;
  grid.innerHTML = '';
  Object.keys(FOLDERS_CONFIG).forEach(k=>{
    const f = FOLDERS_CONFIG[k];
    const card = el('div', { class:'folder-card', role:'button', tabindex:'0', 'data-id':k });
    card.innerHTML = `<div class="folder-icon">${f.icon}</div>
                      <div class="folder-name">${f.name}</div>
                      <div class="folder-desc">${f.desc}</div>`;
    card.addEventListener('click', ()=> openFolder(k));
    card.addEventListener('keydown', (ev)=>{ if(ev.key==='Enter' || ev.key===' ') openFolder(k); });
    grid.appendChild(card);
  });
}

/* ===========================
   OPEN FOLDER
   =========================== */
async function openFolder(folderId) {
  safeLog('Opening folder', folderId);
  refs.folderMenu.classList.add('hidden');
  refs.galleryView.classList.remove('hidden');
  refs.galleryLoading.style.display = 'block';
  refs.videoContainer.innerHTML = '';
  refs.galleryTitle.textContent = `${FOLDERS_CONFIG[folderId].icon} ${FOLDERS_CONFIG[folderId].name}`;

  // if it's the video folder - render video grid
  const folder = FOLDERS_CONFIG[folderId];
  if (!folder) { setGlobalStatus('Folder tidak ditemukan', true); refs.galleryLoading.style.display='none'; return; }

  if (folder.type === 'video' || folderId === 'video') {
    refs.musicPlayerContainer.classList.add('hidden'); // hide music player for video folder
    await renderVideoGrid();
  } else if (folder.type === 'photo') {
    // optional: render photos (not implemented here to keep focus on video)
    refs.photoGalleryContainer.style.display = 'grid';
    refs.videoContainer.style.display = 'none';
  }
  refs.galleryLoading.style.display = 'none';
}

/* ===========================
   RENDER VIDEO GRID
   =========================== */
async function renderVideoGrid() {
  const container = refs.videoContainer;
  container.innerHTML = '';

  for (const v of VIDEO_FILES) {
    const card = el('div', { class:'video-card', tabindex:'0', 'data-id': v.id });

    // thumbnail area (try using video element as poster preview)
    const thumbWrap = el('div', { class:'video-thumb' });
    // create a small preview video element (muted, playsinline) to act as thumbnail
    const preview = document.createElement('video');
    preview.muted = true;
    preview.playsInline = true;
    preview.preload = 'metadata';
    preview.setAttribute('aria-hidden','true');
    preview.src = `${GITHUB_BASE}video/${v.file}`;
    // hide controls on preview
    preview.controls = false;
    preview.style.opacity = '1';

    // fallback poster image: try to use ./video/<id>.jpg or ./video/<id>-thumb.jpg
    const posterCandidates = [
      `${GITHUB_BASE}video/${v.id}.jpg`,
      `${GITHUB_BASE}video/${v.id}-thumb.jpg`,
      `${GITHUB_BASE}video/${v.id}.png`
    ];

    // play overlay UI
    const overlay = el('div', { class:'play-overlay' },
      el('div', { class:'play-button', role:'button', tabindex:'0', 'aria-label':`Putar ${v.title}` }, '‚ñ∫')
    );

    // loading indicator while preview metadata loads
    const loadingIndicator = el('div', { style:'display:flex;gap:8px;align-items:center;'}, el('div',{class:'loading-dot'}), el('div', {}, 'Memuat...'));
    loadingIndicator.style.display = 'none';

    // error message if preview can't load
    const cardError = el('div', { class:'card-error' });
    cardError.style.display = 'none';

    // assemble thumbnail + overlay
    thumbWrap.appendChild(preview);
    thumbWrap.appendChild(overlay);
    thumbWrap.appendChild(loadingIndicator);
    card.appendChild(thumbWrap);

    // meta + actions
    const meta = el('div', { class:'video-meta' });
    const title = el('div', { class:'video-title' }, v.title);
    const rightActions = el('div', { class:'video-actions' });
    const sizeInfo = el('div', {}, '‚Äî'); // placeholder for size or duration
    rightActions.appendChild(sizeInfo);
    meta.appendChild(title);
    meta.appendChild(rightActions);
    card.appendChild(meta);
    card.appendChild(cardError);

    // accessibility: trigger play on overlay click or Enter key
    function triggerPlay(e) {
      e && e.preventDefault();
      // if expanded player already exists for this card, ignore
      const expanded = card.querySelector('.player-expanded');
      if (expanded) return; // already expanded
      createExpandedPlayer(card, v);
    }

    overlay.querySelector('.play-button').addEventListener('click', triggerPlay);
    overlay.querySelector('.play-button').addEventListener('keydown', (ev)=>{ if(ev.key==='Enter'||ev.key===' ') triggerPlay(ev); });

    // Also allow clicking the entire card to open
    card.addEventListener('click', (ev)=> {
      // avoid double-trigger when clicking play-btn
      if (ev.target.closest('.play-button')) return;
      triggerPlay(ev);
    });
    card.addEventListener('keydown', (ev)=> { if (ev.key==='Enter' || ev.key===' ') triggerPlay(ev); });

    // Try to load preview metadata - if fails, replace preview with poster image
    let previewLoaded = false;
    preview.addEventListener('loadedmetadata', ()=> {
      previewLoaded = true;
      loadingIndicator.style.display = 'none';
      // show approximate duration on meta
      try {
        const d = preview.duration;
        if (!isNaN(d) && isFinite(d)) {
          const mins = Math.floor(d / 60);
          const secs = Math.floor(d % 60).toString().padStart(2,'0');
          sizeInfo.textContent = `${mins}:${secs}`;
        }
      } catch(e){}
    });
    preview.addEventListener('error', async ()=> {
      // failed to load preview - try poster candidates
      loadingIndicator.style.display = 'none';
      preview.style.display = 'none';
      // try poster images sequentially
      let posterLoaded = false;
      for (const p of posterCandidates) {
        try {
          const ok = await tryImageLoad(p);
          if (ok) {
            const img = el('img');
            img.src = p;
            img.alt = v.title;
            img.onerror = ()=>{ /* ignore */ };
            // replace preview with image
            thumbWrap.insertBefore(img, overlay);
            posterLoaded = true;
            break;
          }
        } catch(e){}
      }
      if (!posterLoaded) {
        // final fallback to svg placeholder
        const img = el('img');
        img.src = svgPlaceholder('Thumbnail tidak tersedia');
        img.alt = 'thumbnail fallback';
        thumbWrap.insertBefore(img, overlay);
      }
    });

    // show loading while metadata requested
    loadingIndicator.style.display = 'inline-flex';
    // small timeout: if preview doesn't respond in 2.5s, hide loading
    const previewTimeout = setTimeout(()=>{ loadingIndicator.style.display='none'; }, 2500);

    // end of loop: append card
    container.appendChild(card);
    // clear timeout when loaded or error
    preview.addEventListener('loadedmetadata', ()=> clearTimeout(previewTimeout));
    preview.addEventListener('error', ()=> clearTimeout(previewTimeout));
  }
}

/* helper to attempt image load - resolves true/false */
function tryImageLoad(url, timeoutMs=2500) {
  return new Promise((resolve) => {
    const img = new Image();
    let done=false;
    img.onload = () => { if(!done){ done=true; resolve(true); } };
    img.onerror = () => { if(!done){ done=true; resolve(false); } };
    img.src = url;
    setTimeout(()=>{ if(!done){ done=true; resolve(false); } }, timeoutMs);
  });
}

/* ===========================
   CREATE EXPANDED PLAYER (per-card)
   - create <video controls> and attach events
   =========================== */
function createExpandedPlayer(card, videoMeta) {
  // close other expanded players first
  const others = document.querySelectorAll('.player-expanded');
  others.forEach(o=>o.remove());

  const expanded = el('div', { class:'player-expanded' });
  const v = document.createElement('video');
  v.controls = true;
  v.preload = 'metadata';
  v.style.width = '100%';
  v.style.maxHeight = '420px';
  v.playsInline = true;
  v.src = `${GITHUB_BASE}video/${videoMeta.file}`;
  v.setAttribute('aria-label', videoMeta.title);
  v.setAttribute('controlslist', 'nodownload'); // suggestion; not fully supported everywhere

  // show spinner until metadata loaded
  const spinner = el('div', { style:'display:flex;gap:8px;align-items:center;margin-bottom:8px;' }, el('div',{class:'loading-dot'}), el('div',{}, 'Menyiapkan video...'));
  expanded.appendChild(spinner);
  expanded.appendChild(v);

  // append to card
  card.appendChild(expanded);

  // attempt autoplay muted first (some browsers allow it)
  v.muted = true;
  const tryPlay = v.play().then(()=> {
    // autoplay succeeded (muted)
    v.muted = false; // unmute if you want; but many browsers block unmuting programmatically
    spinner.style.display = 'none';
  }).catch(()=> {
    // autoplay blocked -> show controls and hide spinner
    spinner.style.display = 'none';
    // leave muted=false so user can press play
    v.muted = false;
  });

  // error handler
  v.addEventListener('error', (ev)=> {
    spinner.style.display = 'none';
    const err = el('div', { class:'card-error' }, 'Gagal memuat video. Coba refresh atau periksa path file.');
    card.appendChild(err);
  });

  // when playing another video, stop others
  v.addEventListener('play', ()=> {
    stopAllPlayers(v);
  });

  // keyboard: Escape closes expanded player
  expanded.addEventListener('keydown', (ev)=> {
    if (ev.key === 'Escape') expanded.remove();
  });

  // focus on the player so keyboard controls work immediately
  v.focus();
}

/* stop all HTMLMediaElements except optionally one to exclude */
function stopAllPlayers(exclude=null) {
  const media = document.querySelectorAll('video, audio');
  media.forEach(m=>{
    try {
      if (m !== exclude) { m.pause(); if (m.currentTime) m.currentTime = 0; }
    } catch(e){}
  });
}

/* ===========================
   GLOBAL ERROR HANDLER
   =========================== */
window.addEventListener('error', (e)=> {
  console.error('Global error:', e.message, e.filename, e.lineno);
  setGlobalStatus('Terjadi kesalahan pada halaman ‚Äî cek console untuk detail.', true);
});
window.addEventListener('unhandledrejection', (e)=> {
  console.error('Unhandled promise rejection', e.reason);
  setGlobalStatus('Terjadi masalah saat memuat beberapa konten.', true);
});

/* ===========================
   START
   =========================== */
document.addEventListener('DOMContentLoaded', ()=> {
  try {
    init();
    // start at stage1
    refs.stage1.classList.remove('hidden');
    refs.stage2.classList.add('hidden');
    refs.folderMenu.classList.add('hidden');
    refs.galleryView.classList.add('hidden');

    // optional: when user clicks "Boleh Deh" -> stage2 -> go to folder menu -> user selects "Video" to open
    // create an easy direct open for the 'video' folder card click
    // If user wants immediate test: open video folder on load (commented)
    // openFolder('video');

  } catch (err) {
    console.error('Init error', err);
    setGlobalStatus('Inisialisasi gagal: lihat console.', true);
  }
});
</script>
</body>
</html>
